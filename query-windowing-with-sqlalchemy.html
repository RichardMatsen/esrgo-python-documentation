<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Query Windowing with SqlAlchemy ORM | C# Interface port to Python</title>
    <meta name="description" content="C# Interface port to Python">
    
    
    <link rel="preload" href="/esrgo-python-documentation/assets/css/styles.08b8ebf7.css" as="style"><link rel="preload" href="/esrgo-python-documentation/assets/js/app.08b8ebf7.js" as="script"><link rel="preload" href="/esrgo-python-documentation/assets/js/16.8c7136bb.js" as="script"><link rel="preload" href="/esrgo-python-documentation/assets/css/5.styles.92ce2759.css" as="style"><link rel="preload" href="/esrgo-python-documentation/assets/js/5.92ce2759.js" as="script"><link rel="prefetch" href="/esrgo-python-documentation/assets/css/1.styles.dacdc8f1.css"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/1.dacdc8f1.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/css/2.styles.6df4aee8.css"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/2.6df4aee8.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/css/3.styles.62e3bade.css"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/3.62e3bade.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/4.e0e8277f.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/6.b3d7e6cd.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/7.fcd4ff92.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/8.3d242c4d.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/9.234d134d.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/10.fb3d3e85.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/11.d1c152da.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/12.db983685.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/13.542e130d.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/14.bf07540b.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/15.123c7fb9.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/17.4bf3763a.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/18.19d247d1.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/19.a9221979.js">
    <link rel="stylesheet" href="/esrgo-python-documentation/assets/css/5.styles.92ce2759.css"><link rel="stylesheet" href="/esrgo-python-documentation/assets/css/styles.08b8ebf7.css"><link rel="stylesheet" href="/esrgo-python-documentation/assets/css/1.styles.dacdc8f1.css"><link rel="stylesheet" href="/esrgo-python-documentation/assets/css/2.styles.6df4aee8.css"><link rel="stylesheet" href="/esrgo-python-documentation/assets/css/3.styles.62e3bade.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/esrgo-python-documentation/" class="home-link router-link-active"><!----> <span class="site-name">C# Interface port to Python</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/esrgo-python-documentation/" class="nav-link">Overview</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Domain Model</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/domain-generation.html" class="nav-link">Domain Model Code Generation</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/serializing-objects.html" class="nav-link">Serializing Objects in Correct Order</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/initializing-model-classes.html" class="nav-link">Initializing Model Classes</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Processing</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/commands.html" class="nav-link">Commands</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/csv-processing.html" class="nav-link">CSV Processing</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/file-handling-with-regex.html" class="nav-link">File Handling with Regex</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/logging-with-xml-serialization.html" class="nav-link">Logging with XML Serialization</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">SqlAlchemy</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/extracting-data-with-sqlalchemy.html" class="nav-link">Extracting Data with SqlAlchemy ORM</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/query-windowing-with-sqlalchemy.html" class="nav-link router-link-exact-active router-link-active">Query Windowing with SqlAlchemy ORM</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/query-windowing-with-a-filter-criteria.html" class="nav-link">Query Windowing with a Filter Criteria</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/esrgo-python-documentation/" class="nav-link">Overview</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Domain Model</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/domain-generation.html" class="nav-link">Domain Model Code Generation</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/serializing-objects.html" class="nav-link">Serializing Objects in Correct Order</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/initializing-model-classes.html" class="nav-link">Initializing Model Classes</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Processing</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/commands.html" class="nav-link">Commands</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/csv-processing.html" class="nav-link">CSV Processing</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/file-handling-with-regex.html" class="nav-link">File Handling with Regex</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/logging-with-xml-serialization.html" class="nav-link">Logging with XML Serialization</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">SqlAlchemy</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/extracting-data-with-sqlalchemy.html" class="nav-link">Extracting Data with SqlAlchemy ORM</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/query-windowing-with-sqlalchemy.html" class="nav-link router-link-exact-active router-link-active">Query Windowing with SqlAlchemy ORM</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/query-windowing-with-a-filter-criteria.html" class="nav-link">Query Windowing with a Filter Criteria</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Query Windowing with SqlAlchemy ORM</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/esrgo-python-documentation/query-windowing-with-sqlalchemy.html#the-need-for-output-batching" class="sidebar-link">The Need for Output Batching</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/esrgo-python-documentation/query-windowing-with-sqlalchemy.html#querywindow" class="sidebar-link">QueryWindow</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/esrgo-python-documentation/query-windowing-with-sqlalchemy.html#tests" class="sidebar-link">Tests</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="query-windowing-with-sqlalchemy-orm"><a href="#query-windowing-with-sqlalchemy-orm" aria-hidden="true" class="header-anchor">#</a> Query Windowing with SqlAlchemy ORM</h1> <h2 id="the-need-for-output-batching"><a href="#the-need-for-output-batching" aria-hidden="true" class="header-anchor">#</a> The Need for Output Batching</h2> <p>When creating an outbound interface, there are two scenarios where we may need to break the output up into smaller chunks:</p> <ul><li><p>The full result set may exceed memory capacity</p></li> <li><p>The transport mechanism may have a limited packet size</p></li></ul> <h2 id="querywindow"><a href="#querywindow" aria-hidden="true" class="header-anchor">#</a> QueryWindow</h2> <p>The SqlAlchemy Query object extracts data in a single select so by default the whole result set is returned to memory. To select in window batches, we need to add filters based on id ranges to the original query. The basic approach was adapted from a recipe given by</p> <p>https://bitbucket.org/zzzeek/sqlalchemy/wiki/UsageRecipes/WindowedRangeQuery</p> <p>The main class <strong>QueryWindow</strong> accepts the original query and breakdown parameters - break_column and window_size. It finds the interval boundaries with the get_intervals() method by issuing a query against the whole table using the row_number function to apply a sequence to the ids.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">QueryWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> query<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> window_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> break_column<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>query <span class="token operator">=</span> query
        <span class="token keyword">if</span> break_column <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            break_column <span class="token operator">=</span> self<span class="token punctuation">.</span>get_primary_key<span class="token punctuation">(</span>query<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>break_column <span class="token operator">=</span> break_column
        self<span class="token punctuation">.</span>window_size <span class="token operator">=</span> window_size
        self<span class="token punctuation">.</span>intervals <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">_get_intervals</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        session <span class="token operator">=</span> self<span class="token punctuation">.</span>query<span class="token punctuation">.</span>session
        q <span class="token operator">=</span> session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>self<span class="token punctuation">.</span>break_column<span class="token punctuation">,</span>
                          func<span class="token punctuation">.</span>row_number<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span> \
                          over<span class="token punctuation">(</span>order_by<span class="token operator">=</span>self<span class="token punctuation">.</span>break_column<span class="token punctuation">)</span><span class="token punctuation">.</span> \
                          label<span class="token punctuation">(</span><span class="token string">'rownum'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> \
                    <span class="token punctuation">.</span>from_self<span class="token punctuation">(</span>self<span class="token punctuation">.</span>break_column<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>window_size <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
            q <span class="token operator">=</span> q<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span><span class="token string">&quot;rownum %% %d=1&quot;</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>window_size<span class="token punctuation">)</span>
        interval_starts <span class="token operator">=</span> <span class="token punctuation">[</span>start_value <span class="token keyword">for</span> start_value<span class="token punctuation">,</span> <span class="token keyword">in</span> q<span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>intervals <span class="token operator">=</span> <span class="token punctuation">[</span>QueryWindowInterval<span class="token punctuation">(</span>self<span class="token punctuation">.</span>query<span class="token punctuation">,</span> self<span class="token punctuation">.</span>break_column<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">)</span>
                          <span class="token keyword">for</span> start<span class="token punctuation">,</span> end 
                          <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>interval_starts<span class="token punctuation">,</span> interval_starts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">rows</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>intervals <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_get_intervals<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> interval <span class="token keyword">in</span> self<span class="token punctuation">.</span>intervals<span class="token punctuation">:</span>
            <span class="token keyword">for</span> row <span class="token keyword">in</span> interval<span class="token punctuation">.</span>rows<span class="token punctuation">:</span>
                <span class="token keyword">yield</span> row

    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>intervals <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_get_intervals<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>intervals<span class="token punctuation">.</span>__iter__<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>The result is a list of QueryWindowInterval classes which compose the filtered query and also record the start and end boundaries for debugging purposes.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">QueryWindowInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> base_query<span class="token punctuation">,</span> break_column<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>base_query <span class="token operator">=</span> base_query
        self<span class="token punctuation">.</span>break_column <span class="token operator">=</span> break_column
        self<span class="token punctuation">.</span>start <span class="token operator">=</span> start
        self<span class="token punctuation">.</span>end <span class="token operator">=</span> end
        self<span class="token punctuation">.</span><span class="token builtin">range</span> <span class="token operator">=</span> <span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span><span class="token builtin">filter</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>_window_filter<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>query <span class="token operator">=</span> self<span class="token punctuation">.</span>base_query<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span>self<span class="token punctuation">.</span>break_column<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_window_filter</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>end<span class="token punctuation">:</span>
            <span class="token keyword">return</span> and_<span class="token punctuation">(</span>
                self<span class="token punctuation">.</span>break_column <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>start<span class="token punctuation">,</span>
                self<span class="token punctuation">.</span>break_column <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>end
            <span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>break_column <span class="token operator">&gt;=</span> self<span class="token punctuation">.</span>start

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">rows</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> row <span class="token keyword">in</span> self<span class="token punctuation">.</span>query<span class="token punctuation">:</span>
            <span class="token keyword">yield</span> row

    <span class="token keyword">def</span> <span class="token function">__repr__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">&quot;range {0}:{1}, filter: {2}&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>start<span class="token punctuation">,</span> self<span class="token punctuation">.</span>end<span class="token punctuation">,</span> self<span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>rows
</code></pre></div><h2 id="tests"><a href="#tests" aria-hidden="true" class="header-anchor">#</a> Tests</h2> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">test01_creates_intervals</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    db <span class="token operator">=</span> self<span class="token punctuation">.</span>_make_db_with_addresses<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    query <span class="token operator">=</span> db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Address<span class="token punctuation">)</span>
    query_window <span class="token operator">=</span> QueryWindow<span class="token punctuation">(</span>query<span class="token punctuation">,</span> window_size<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> break_column<span class="token operator">=</span>Address<span class="token punctuation">.</span>Id<span class="token punctuation">)</span>
    query_window<span class="token punctuation">.</span>_get_intervals<span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">test02_break_column_defaults_to_key</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    db <span class="token operator">=</span> self<span class="token punctuation">.</span>_make_db_with_addresses<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    query <span class="token operator">=</span> db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Address<span class="token punctuation">)</span>
    qw <span class="token operator">=</span> QueryWindow<span class="token punctuation">(</span>query<span class="token punctuation">,</span> window_size<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
    query_window<span class="token punctuation">.</span>_get_intervals<span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">test03_creates_intervals_breaking_on_date</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    db <span class="token operator">=</span> self<span class="token punctuation">.</span>_make_db_with_addresses<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    query <span class="token operator">=</span> db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Address<span class="token punctuation">)</span>
    query_window <span class="token operator">=</span> QueryWindow<span class="token punctuation">(</span>query<span class="token punctuation">,</span> window_size<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> break_column<span class="token operator">=</span>Address<span class="token punctuation">.</span>EffectiveDate<span class="token punctuation">)</span>
    query_window<span class="token punctuation">.</span>_get_intervals<span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span>datetime<span class="token punctuation">(</span><span class="token number">2012</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> datetime<span class="token punctuation">(</span><span class="token number">2012</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span>datetime<span class="token punctuation">(</span><span class="token number">2012</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">test04_can_select_rows</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    db <span class="token operator">=</span> self<span class="token punctuation">.</span>_make_db_with_addresses<span class="token punctuation">(</span><span class="token number">100</span>
    query <span class="token operator">=</span> db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Address<span class="token punctuation">)</span>
    query_window <span class="token operator">=</span> QueryWindow<span class="token punctuation">(</span>query<span class="token punctuation">,</span> window_size<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
    results <span class="token operator">=</span> <span class="token punctuation">[</span>row <span class="token keyword">for</span> row <span class="token keyword">in</span> query_window<span class="token punctuation">.</span>rows<span class="token punctuation">]</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">type</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span> <span class="token operator">==</span> Address <span class="token keyword">for</span> row <span class="token keyword">in</span> results<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> row <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>i<span class="token punctuation">,</span> row<span class="token punctuation">.</span>Id<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>datetime<span class="token punctuation">(</span><span class="token number">2012</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> row<span class="token punctuation">.</span>EffectiveDate<span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">test05_can_select_rows_with_date_break</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    db <span class="token operator">=</span> self<span class="token punctuation">.</span>_make_db_with_addresses<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    query <span class="token operator">=</span> db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Address<span class="token punctuation">)</span>
    query_window <span class="token operator">=</span> QueryWindow<span class="token punctuation">(</span>query<span class="token punctuation">,</span> window_size<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> break_column<span class="token operator">=</span>Address<span class="token punctuation">.</span>EffectiveDate<span class="token punctuation">)</span>
    results <span class="token operator">=</span> <span class="token punctuation">[</span>row <span class="token keyword">for</span> row <span class="token keyword">in</span> query_window<span class="token punctuation">.</span>rows<span class="token punctuation">]</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">type</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span> <span class="token operator">==</span> Address <span class="token keyword">for</span> row <span class="token keyword">in</span> results<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> row <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>i<span class="token punctuation">,</span> row<span class="token punctuation">.</span>Id<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>datetime<span class="token punctuation">(</span><span class="token number">2012</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> row<span class="token punctuation">.</span>EffectiveDate<span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">test06_can_iterate_the_intervals</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    db <span class="token operator">=</span> self<span class="token punctuation">.</span>_make_db_with_addresses<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    query <span class="token operator">=</span> db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Address<span class="token punctuation">)</span>
    query_window <span class="token operator">=</span> QueryWindow<span class="token punctuation">(</span>query<span class="token punctuation">,</span> window_size<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
    intervals <span class="token operator">=</span> <span class="token punctuation">[</span>interval <span class="token keyword">for</span> interval <span class="token keyword">in</span> qw<span class="token punctuation">]</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>intervals<span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertTrue<span class="token punctuation">(</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">type</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span> <span class="token operator">==</span> QueryWindowInterval <span class="token keyword">for</span> row <span class="token keyword">in</span> intervals<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">test07_window_size_zero_gets_one_row_at_a_time</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    db <span class="token operator">=</span> self<span class="token punctuation">.</span>_make_db_with_addresses<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
    query <span class="token operator">=</span> db<span class="token punctuation">.</span>session<span class="token punctuation">.</span>query<span class="token punctuation">(</span>Address<span class="token punctuation">,</span> window_size<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
    query_window <span class="token operator">=</span> QueryWindow<span class="token punctuation">(</span>query<span class="token punctuation">)</span>
    query_window<span class="token punctuation">.</span>_get_intervals<span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">,</span> query_window<span class="token punctuation">.</span>intervals<span class="token punctuation">[</span><span class="token number">99</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">range</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">test08sql_statement_is_partitioned</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    expected <span class="token operator">=</span> \
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    SELECT widget.id, widget.data
    FROM widget
    WHERE widget.id &gt;= {0} AND widget.id &lt; {1} ORDER BY widget.id
    &quot;&quot;&quot;</span>
    expected_last <span class="token operator">=</span> \
    <span class="token triple-quoted-string string">&quot;&quot;&quot;
    SELECT widget.id, widget.data
    FROM widget
    WHERE widget.id &gt;= {0} ORDER BY widget.id
    &quot;&quot;&quot;</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> sql <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>query_window<span class="token punctuation">.</span>sql_statement<span class="token punctuation">)</span><span class="token punctuation">:</span>
        lower <span class="token operator">=</span> i <span class="token operator">*</span> self<span class="token punctuation">.</span>query_window<span class="token punctuation">.</span>window_size
        upper <span class="token operator">=</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>query_window<span class="token punctuation">.</span>window_size
        <span class="token keyword">if</span> upper <span class="token operator">&lt;=</span> self<span class="token punctuation">.</span>data_count<span class="token punctuation">:</span>
            assert_docstrings_are_equal<span class="token punctuation">(</span>self<span class="token punctuation">,</span> expected<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>lower<span class="token punctuation">,</span> upper<span class="token punctuation">)</span><span class="token punctuation">,</span> sql<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            assert_docstrings_are_equal<span class="token punctuation">(</span>self<span class="token punctuation">,</span> expected_last<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>lower<span class="token punctuation">)</span><span class="token punctuation">,</span> sql<span class="token punctuation">)</span>
</code></pre></div><div class="minimap-container" style="width:250px;" data-v-5674b532><div class="minimap" style="top:250px;zoom:25%;" data-v-5674b532><div data-v-5674b532></div></div></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/esrgo-python-documentation/assets/js/16.8c7136bb.js" defer></script><script src="/esrgo-python-documentation/assets/js/5.92ce2759.js" defer></script><script src="/esrgo-python-documentation/assets/js/app.08b8ebf7.js" defer></script>
  </body>
</html>
