<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Logging with XML Serialization | C# Interface port to Python</title>
    <meta name="description" content="C# Interface port to Python">
    
    
    <link rel="preload" href="/esrgo-python-documentation/assets/css/styles.08b8ebf7.css" as="style"><link rel="preload" href="/esrgo-python-documentation/assets/js/app.08b8ebf7.js" as="script"><link rel="preload" href="/esrgo-python-documentation/assets/js/14.bf07540b.js" as="script"><link rel="preload" href="/esrgo-python-documentation/assets/css/5.styles.92ce2759.css" as="style"><link rel="preload" href="/esrgo-python-documentation/assets/js/5.92ce2759.js" as="script"><link rel="prefetch" href="/esrgo-python-documentation/assets/css/1.styles.dacdc8f1.css"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/1.dacdc8f1.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/css/2.styles.6df4aee8.css"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/2.6df4aee8.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/css/3.styles.62e3bade.css"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/3.62e3bade.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/4.e0e8277f.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/6.b3d7e6cd.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/7.fcd4ff92.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/8.3d242c4d.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/9.234d134d.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/10.fb3d3e85.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/11.d1c152da.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/12.db983685.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/13.542e130d.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/15.123c7fb9.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/16.8c7136bb.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/17.4bf3763a.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/18.19d247d1.js"><link rel="prefetch" href="/esrgo-python-documentation/assets/js/19.a9221979.js">
    <link rel="stylesheet" href="/esrgo-python-documentation/assets/css/5.styles.92ce2759.css"><link rel="stylesheet" href="/esrgo-python-documentation/assets/css/styles.08b8ebf7.css"><link rel="stylesheet" href="/esrgo-python-documentation/assets/css/1.styles.dacdc8f1.css"><link rel="stylesheet" href="/esrgo-python-documentation/assets/css/2.styles.6df4aee8.css"><link rel="stylesheet" href="/esrgo-python-documentation/assets/css/3.styles.62e3bade.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/esrgo-python-documentation/" class="home-link router-link-active"><!----> <span class="site-name">C# Interface port to Python</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/esrgo-python-documentation/" class="nav-link">Overview</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Domain Model</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/domain-generation.html" class="nav-link">Domain Model Code Generation</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/serializing-objects.html" class="nav-link">Serializing Objects in Correct Order</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/initializing-model-classes.html" class="nav-link">Initializing Model Classes</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Processing</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/commands.html" class="nav-link">Commands</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/csv-processing.html" class="nav-link">CSV Processing</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/file-handling-with-regex.html" class="nav-link">File Handling with Regex</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/logging-with-xml-serialization.html" class="nav-link router-link-exact-active router-link-active">Logging with XML Serialization</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">SqlAlchemy</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/extracting-data-with-sqlalchemy.html" class="nav-link">Extracting Data with SqlAlchemy ORM</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/query-windowing-with-sqlalchemy.html" class="nav-link">Query Windowing with SqlAlchemy ORM</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/query-windowing-with-a-filter-criteria.html" class="nav-link">Query Windowing with a Filter Criteria</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/esrgo-python-documentation/" class="nav-link">Overview</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Domain Model</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/domain-generation.html" class="nav-link">Domain Model Code Generation</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/serializing-objects.html" class="nav-link">Serializing Objects in Correct Order</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/initializing-model-classes.html" class="nav-link">Initializing Model Classes</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Processing</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/commands.html" class="nav-link">Commands</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/csv-processing.html" class="nav-link">CSV Processing</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/file-handling-with-regex.html" class="nav-link">File Handling with Regex</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/logging-with-xml-serialization.html" class="nav-link router-link-exact-active router-link-active">Logging with XML Serialization</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">SqlAlchemy</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/extracting-data-with-sqlalchemy.html" class="nav-link">Extracting Data with SqlAlchemy ORM</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/query-windowing-with-sqlalchemy.html" class="nav-link">Query Windowing with SqlAlchemy ORM</a></li><li class="dropdown-item"><!----> <a href="/esrgo-python-documentation/query-windowing-with-a-filter-criteria.html" class="nav-link">Query Windowing with a Filter Criteria</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Logging with XML Serialization</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/esrgo-python-documentation/logging-with-xml-serialization.html#process-run-logging" class="sidebar-link">Process Run Logging</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/esrgo-python-documentation/logging-with-xml-serialization.html#the-processaudit-object" class="sidebar-link">The ProcessAudit object</a></li><li class="sidebar-sub-header"><a href="/esrgo-python-documentation/logging-with-xml-serialization.html#context-manager-ensures-file-is-written" class="sidebar-link">Context Manager ensures file is written</a></li><li class="sidebar-sub-header"><a href="/esrgo-python-documentation/logging-with-xml-serialization.html#decorator-improves-clarity" class="sidebar-link">Decorator Improves Clarity</a></li></ul></li><li><a href="/esrgo-python-documentation/logging-with-xml-serialization.html#example-audit-log-content" class="sidebar-link">Example Audit Log Content</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/esrgo-python-documentation/logging-with-xml-serialization.html#converting-to-xml" class="sidebar-link">Converting To XML</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/esrgo-python-documentation/logging-with-xml-serialization.html#top-level-functions" class="sidebar-link">Top level functions</a></li><li class="sidebar-sub-header"><a href="/esrgo-python-documentation/logging-with-xml-serialization.html#recursive-parsing" class="sidebar-link">Recursive Parsing</a></li><li class="sidebar-sub-header"><a href="/esrgo-python-documentation/logging-with-xml-serialization.html#the-xml-property" class="sidebar-link">The _xml_ property</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="logging-with-xml-serialization"><a href="#logging-with-xml-serialization" aria-hidden="true" class="header-anchor">#</a> Logging with XML Serialization</h1> <h2 id="process-run-logging"><a href="#process-run-logging" aria-hidden="true" class="header-anchor">#</a> Process Run Logging</h2> <p>Logging of process run information is a useful tool for debugging and support. The features we want are:</p> <ul><li><p>Quiet background logging with minimal impact</p></li> <li><p>More structure in the output than a sequence of text file lines</p></li> <li><p>Minimal dependency on external libraries</p></li> <li><p>Output written even if the logged process fails</p></li> <li><p>Easy to extend with new information</p></li></ul> <h3 id="the-processaudit-object"><a href="#the-processaudit-object" aria-hidden="true" class="header-anchor">#</a> The ProcessAudit object</h3> <p>The approach taken uses a top level container which has properties for the objects of interest. It emits them to an XML file during each run. The XML is generated via simple serialization, with object-based properties defining their own XML structure.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">ProcessRunAudit</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> output_directory<span class="token punctuation">)</span><span class="token punctuation">:</span>
        AuditBase<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> output_directory<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>event_summary <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>directory_scanner_data <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>events <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>errors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self

    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_type<span class="token punctuation">,</span> exc_val<span class="token punctuation">,</span> exc_tb<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token punctuation">)</span>

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">output_file_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">&quot;Process_audit_{}.xml&quot;</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>start_time<span class="token punctuation">)</span>

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">has_fatal_errors</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">any</span><span class="token punctuation">(</span>e <span class="token keyword">for</span> e <span class="token keyword">in</span> self<span class="token punctuation">.</span>errors 
               <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">'severity'</span><span class="token punctuation">)</span> <span class="token operator">and</span> e<span class="token punctuation">.</span>severity <span class="token operator">==</span> CsvErrorSeverityLevel<span class="token punctuation">.</span>Fatal<span class="token punctuation">)</span>

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">__xml__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>event_summary <span class="token operator">=</span> EventSummary<span class="token punctuation">(</span>self<span class="token punctuation">.</span>events<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Process_Run'</span><span class="token punctuation">,</span> <span class="token string">'Process at {0}, duration {1}. Has fatal errors: {2}'</span>
                 <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>start_time<span class="token punctuation">,</span> self<span class="token punctuation">.</span>duration<span class="token punctuation">,</span> self<span class="token punctuation">.</span>has_fatal_errors<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">'Event_Summary'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>event_summary<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">'Errors'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>errors<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">'InboundDirectoryScanner'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>directory_scanner_data<span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div><h3 id="context-manager-ensures-file-is-written"><a href="#context-manager-ensures-file-is-written" aria-hidden="true" class="header-anchor">#</a> Context Manager ensures file is written</h3> <p>Note that ProcessAudit is a context manager, because it implements <strong>enter</strong> and <strong>exit</strong> methods. This means we get an audit log written even if there is an exception during processing.</p> <h3 id="decorator-improves-clarity"><a href="#decorator-improves-clarity" aria-hidden="true" class="header-anchor">#</a> Decorator Improves Clarity</h3> <p>To apply the ProcessAudit object to a class method, we could use the with keyword to create the scope for the context manager:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">UpdateRepositoryCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">do_it</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> ProcessRunAudit<span class="token punctuation">(</span>self<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>audit_path<span class="token punctuation">)</span> <span class="token keyword">as</span> self<span class="token punctuation">.</span>process_run_audit<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>process_run_audit<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
            <span class="token operator">&lt;&lt;</span>processing code here<span class="token operator">&gt;&gt;</span>
            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><p>However, since auditing is a cross-cutting concern (i.e not part of the process logic), this syntax reduces clarity of the command class. Another way to implement it is with a decorator:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">UpdateRepositoryCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    @audit_process
    <span class="token keyword">def</span> <span class="token function">do_it</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token operator">&lt;&lt;</span>processing code here<span class="token operator">&gt;&gt;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><p>This decorator shifts the context manager code out to a wrapper class:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> Audit<span class="token punctuation">.</span>processrun_audit <span class="token keyword">import</span> ProcessRunAudit

<span class="token keyword">def</span> <span class="token function">audit_process</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">wrapper</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
        instance <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">with</span> ProcessRunAudit<span class="token punctuation">(</span>instance<span class="token punctuation">.</span>audit_path<span class="token punctuation">)</span> <span class="token keyword">as</span> processrun_audit<span class="token punctuation">:</span>
            instance<span class="token punctuation">.</span>process_run_audit <span class="token operator">=</span> processrun_audit
            processrun_audit<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
            result <span class="token operator">=</span> f<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span>
            <span class="token keyword">return</span> result
    <span class="token keyword">return</span> wrapper
</code></pre></div><p>Note the use of args[0] to get the class instance. This allows a decorator to be applied to a class method.</p> <h2 id="example-audit-log-content"><a href="#example-audit-log-content" aria-hidden="true" class="header-anchor">#</a> Example Audit Log Content</h2> <p>This is an example of the content:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; ?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ProcessAudit</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Process_Run</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>start_time</span><span class="token punctuation">&gt;</span></span>2014-01-31 20:00:11.344973<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>start_time</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>finish_time</span><span class="token punctuation">&gt;</span></span>2014-01-31 20:00:14.403301<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>finish_time</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>duration</span><span class="token punctuation">&gt;</span></span>0:00:03.058328<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>duration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file_count</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file_count</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>error_count</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>error_count</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Process_Run</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Event_Summary</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EventCount</span><span class="token punctuation">&gt;</span></span>Insert Address, 180<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EventCount</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EventCount</span><span class="token punctuation">&gt;</span></span>Insert Assignment, 413<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EventCount</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EventCount</span><span class="token punctuation">&gt;</span></span>Insert AssignmentCosting, 249<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EventCount</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EventCount</span><span class="token punctuation">&gt;</span></span>Insert Competence, 1660<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EventCount</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EventCount</span><span class="token punctuation">&gt;</span></span>Insert ContactRelationship, 164<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EventCount</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EventCount</span><span class="token punctuation">&gt;</span></span>Insert ExtendedInformationType, 374<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EventCount</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EventCount</span><span class="token punctuation">&gt;</span></span>Insert PersonDetail, 172<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EventCount</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EventCount</span><span class="token punctuation">&gt;</span></span>Insert Phone, 350<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EventCount</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EventCount</span><span class="token punctuation">&gt;</span></span>Insert Position, 3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EventCount</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EventCount</span><span class="token punctuation">&gt;</span></span>Insert Qualification, 42<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EventCount</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Event_Summary</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Errors</span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>InboundDirectoryScanner</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DirectoryScannerParameters</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>InboundDirectory</span><span class="token punctuation">&gt;</span></span>D:\InterfaceRepositoryWorkDirectory\LOCAL\IN<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>InboundDirectory</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>VPD</span><span class="token punctuation">&gt;</span></span>123<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>VPD</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LastSeqProcessed</span><span class="token punctuation">&gt;</span></span>27<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LastSeqProcessed</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>NumberOfFilesToProcess</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>NumberOfFilesToProcess</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FullFile</span><span class="token punctuation">&gt;</span></span>File: XX_123_YYY_TFF_20130806_00000008.DAT, type: TFF, seq: 8, vpd: 123<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>FullFile</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DirectoryScannerParameters</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Files_Processed</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FileName</span><span class="token punctuation">&gt;</span></span>File: XX_123_YYY_TFC_20130807_00000009.DAT, type: TFC, seq: 9, vpd: 123<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Filename</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Files_Processed</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Files_Ignored</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FileName</span><span class="token punctuation">&gt;</span></span>File: XX_123_YYY_TFC_20130724_00000004.DAT_txfr, type: TFC, seq: 4, vpd: 123, 
                     Exclude reason: In process of transferring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EsrGoFileName</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FileName</span><span class="token punctuation">&gt;</span></span>File: XX_123_YYY_TFF_20130601_00000001.DAT, type: TFF, seq: 1, vpd: 123, 
                     Exclude reason: Precedes sequence number from last run<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>EsrGoFileName</span><span class="token punctuation">&gt;</span></span>
...
</code></pre></div><h2 id="converting-to-xml"><a href="#converting-to-xml" aria-hidden="true" class="header-anchor">#</a> Converting To XML</h2> <p>There are several xml libraries available in Python, but to get the facility required for the audit log a set of high level functions were built on top of xml.etree.cElementTree and also xml.dom.minidom to format to output in a readable way.</p> <p>The features needed were:</p> <ul><li><p>Pass in a single top level object to serialize.</p></li> <li><p>Output either all object attributes (from <strong>dict</strong>) or a specified layout from the <strong>audit</strong> method.</p></li> <li><p>When source is <strong>dict</strong>, emit the attributes in the order instantiated (not random dictionary order).</p></li> <li><p>Recurse down through nested objects.</p></li> <li><p>Handle lists of objects and /or scalars, and possibly mixed type lists.</p></li> <li><p>Allow tag strings to be specified in the form of tuples: (tag_string, data).</p></li> <li><p>When tags are not specified, use object and attribute names as xml tags.</p></li></ul> <h3 id="top-level-functions"><a href="#top-level-functions" aria-hidden="true" class="header-anchor">#</a> Top level functions</h3> <p>At the top level, there’s a save_as_xml() function to output to a file, or a to_xml() function to return the result as a string. These call into object_to_element() which establishes the root, and calls down to _convert_object_to_xml_recursive(), which of course is where nested objects are handled recursively.</p> <figure><img src="/esrgo-python-documentation/assets/img/top-level-functions.5905a529.png" alt="top-level-functions"> <figcaption><i>(click to enlarge)</i></figcaption></figure> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">def</span> <span class="token function">save_as_xml</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> file_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    xml_string <span class="token operator">=</span> to_xml<span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>file_name<span class="token punctuation">,</span> <span class="token string">'wt'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>writelines<span class="token punctuation">(</span>xml_string<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">to_xml</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
    obj_as_xml_element <span class="token operator">=</span> object_to_element<span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    xml_encoded_byte_array <span class="token operator">=</span> ET<span class="token punctuation">.</span>tostring<span class="token punctuation">(</span>obj_as_xml_element<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'xml'</span><span class="token punctuation">)</span>
    xml_document <span class="token operator">=</span> xml<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>minidom<span class="token punctuation">.</span>parseString<span class="token punctuation">(</span>xml_encoded_byte_array<span class="token punctuation">)</span>
    xml_pprint_string <span class="token operator">=</span> xml_document<span class="token punctuation">.</span>toprettyxml<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> xml_pprint_string

<span class="token keyword">def</span> <span class="token function">object_to_element</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
    root_tag <span class="token operator">=</span> <span class="token builtin">type</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span>__name__
    root <span class="token operator">=</span> ET<span class="token punctuation">.</span>Element<span class="token punctuation">(</span>root_tag<span class="token punctuation">)</span>
    _convert_object_to_xml_recursive<span class="token punctuation">(</span>root<span class="token punctuation">,</span> obj<span class="token punctuation">)</span>
    <span class="token keyword">return</span> root
</code></pre></div><h3 id="recursive-parsing"><a href="#recursive-parsing" aria-hidden="true" class="header-anchor">#</a> Recursive Parsing</h3> <p>The following diagram shows the flow of the recursive parsing functions. The data entering _convert_object_to_xml_recursive() can be a list, a single object, or a scalar type. Lists are recursed for each item, objects are recursed for each attribute, and scalar items are added to the parent content and recursion stops.</p> <figure><img src="/esrgo-python-documentation/assets/img/recursive-parsing.f98dd8b4.png" alt="recursive-parsing"> <figcaption><i>(click to enlarge)</i></figcaption></figure> <h3 id="the-xml-property"><a href="#the-xml-property" aria-hidden="true" class="header-anchor">#</a> The <strong>xml</strong> property</h3> <p>The <strong>xml</strong> property is provided as an (optional) way of defining an object’s xml representation, in the same way as <strong>str</strong> and <strong>repr</strong> are used to define outputs for string representation and repl text.</p> <p>The format for the <strong>xml</strong> return value can be:</p> <ul><li>A single scalar</li> <li>A single object</li> <li>A list of
<ul><li>scalars</li> <li>objects</li> <li>attributes</li> <li>mixed</li></ul></li></ul> <p>This allows precise defining of the XML output, the ordering of items, and selective output of attributes.</p> <p>For example,</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">ProcessRunAudit</span><span class="token punctuation">(</span>AuditBase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token operator">&lt;&lt;</span>Some other stuff<span class="token operator">&gt;&gt;</span>
    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">__xml__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>event_summary <span class="token operator">=</span> EventSummary<span class="token punctuation">(</span>self<span class="token punctuation">.</span>events<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Process_Run'</span><span class="token punctuation">,</span> <span class="token string">'Process at {0}, duration {1}. Has fatal errors: {2}'</span>
                 <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>start_time<span class="token punctuation">,</span> self<span class="token punctuation">.</span>duration<span class="token punctuation">,</span> self<span class="token punctuation">.</span>has_fatal_errors<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">'Event_Summary'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>event_summary<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">'Errors'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>errors<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">'InboundDirectoryScanner'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>directory_scanner_data<span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">class</span> <span class="token class-name">InboundDirectoryScanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token operator">&lt;&lt;</span>Some other stuff<span class="token operator">&gt;&gt;</span>
    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">__xml__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'ScannerParameters'</span><span class="token punctuation">,</span>
                   <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'InboundDirectory'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>directory<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">(</span><span class="token string">'VPD'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>vpd<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">(</span><span class="token string">'LastSeqProcessed'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>last_sequence_number_processed<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">(</span><span class="token string">'NumberOfFilesToProcess'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>num_files_to_process<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">(</span><span class="token string">'FullFile'</span><span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>full_file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">'Files_Processed'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>files_included<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span><span class="token string">'Files_Ignored'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>files_excluded<span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div><p>Note that elements of the <strong>xml</strong> list can be tuples, where the first item is the literal element tag to be used. If no tag is provided, the object’s class name is used.</p> <div class="minimap-container" style="width:250px;" data-v-5674b532><div class="minimap" style="top:250px;zoom:25%;" data-v-5674b532><div data-v-5674b532></div></div></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/esrgo-python-documentation/assets/js/14.bf07540b.js" defer></script><script src="/esrgo-python-documentation/assets/js/5.92ce2759.js" defer></script><script src="/esrgo-python-documentation/assets/js/app.08b8ebf7.js" defer></script>
  </body>
</html>
